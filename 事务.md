# 事务
### mysql 服务器逻辑架构
![](http://img.blog.itpub.net/blog/2019/04/26/f68486c04022aad0.jpeg?x-oss-process=style/bb)
### 事务的特性：

- 原子性：指处于同一个事务中的多条语句是**不可分割**的。
- 一致性：事务必须使数据库**从一个一致性状态变换到另外一个一致性**状态。比如转账，转账前两个账户余额之和为2k，转账之后也应该是2K。
- 隔离性：指多线程环境下，一个线程中的事务不能被其他线程中的事务**打扰**
- 持久性：事务一旦提交，就应该被**永久保存**起来。
### 事务隔离性问题：
如果不考虑事务的隔离性，会出现以下问题：
- 更新丢失（Lost Update）：当多个事务选择同一行操作，并且都是基于最初选定的值，由于每个事务都不知道其他事务的存在，就会发生更新覆盖的问题。类比github提交冲突。
- 脏读：指一个线程中的事务读取到了另外一个线程中**未提交**的数据。
- 不可重复读（虚读）：是指事务中，两次查询的结果不一致，原因，在查询的过程中，其他事务做了**更新**的操作
- 幻读：是指事务中，两次查询的结果不一致，原因，在查询的过程中，其他事务做了**插入**的操作
#### 不可重复读和幻读的区别在于不可重复读是由于另一个事务对数据的更改所造成的，而幻读是由于另一个事务插入或删除引起的。
#### 从控制的角度来看, 两者的区别就比较大：
- 对于前者, 只需要锁住满足条件的记录
- 对于后者, 要锁住满足条件及其相近的记录
### 隔离级别：
隔离级别|	脏读（Dirty Read）|	不可重复读（NonRepeatable Read）|	幻读（Phantom Read）|
----|----|----|----|
未提交读（Read uncommitted）|	可能|	可能|	可能|
已提交读（Read committed）|	不可能	|可能|	可能
可重复读（Repeatable read）|	不可能|	不可能|	可能
可串行化（Serializable ）|	不可能	|不可能|	不可能
#### 级别越高，数据越安全，但性能越低。
